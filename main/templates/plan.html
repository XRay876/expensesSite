{% extends 'layout.html' %}
{% load static %}
{% load custom_tags %}

{% block title %}Planning{% endblock %}

{% block content %}
    <div class="planning-container">
        <div class="planning-title">
            <h1>Planning page</h1>
            <p>Make your plans here</p>
        </div>
        <div class="nav-buttons">

            <button class="logout-Btn share-button" id="export-button">

                <div class="sign share-btn">
                    <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" fill="none">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill="#ffffff" fill-rule="evenodd"
                                  d="M11 2a1 1 0 10-2 0v7.74L5.173 6.26a1 1 0 10-1.346 1.48l5.5 5a1 1 0 001.346 0l5.5-5a1 1 0 00-1.346-1.48L11 9.74V2zm-7.895 9.204A1 1 0 001.5 12v3.867a2.018 2.018 0 002.227 2.002c1.424-.147 3.96-.369 6.273-.369 2.386 0 5.248.236 6.795.383a2.013 2.013 0 002.205-2V12a1 1 0 10-2 0v3.884l-13.895-4.68zm0 0L2.5 11l.605.204zm0 0l13.892 4.683a.019.019 0 01-.007.005h-.006c-1.558-.148-4.499-.392-6.984-.392-2.416 0-5.034.23-6.478.38h-.009a.026.026 0 01-.013-.011V12a.998.998 0 00-.394-.796z"></path>
                        </g>
                    </svg>
                </div>

                <div class="text">Share</div>
            </button>

            <a href="{% url 'home' %}">
                <div class="logout-Btn share-button">

                    <div class="sign sign-shared">
                        <svg viewBox="0 0 20 20" version="1.1"
                             xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             fill="#000000" transform="translate(1.3, 0)">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"
                               stroke="#CCCCCC" stroke-width="0.304"></g>
                            <g id="SVGRepo_iconCarrier"><title>home [#1393]</title>
                                <defs></defs>
                                <g id="Page-1" stroke-width="0.00019" fill="none" fill-rule="evenodd">
                                    <g id="Dribbble-Light-Preview" transform="translate(-341.000000, -720.000000)"
                                       fill="#000000">
                                        <g id="icons" transform="translate(56.000000, 160.000000)">
                                            <path d="M299.875,576.21213 C299.875,576.76413 299.399,577.00013 298.8125,577.00013 L297.75,577.00013 C297.1635,577.00013 296.6875,576.76413 296.6875,576.21213 L296.6875,575.21213 C296.6875,574.10713 295.736562,573.00013 294.5625,573.00013 L292.4375,573.00013 C291.263438,573.00013 290.3125,574.10713 290.3125,575.21213 L290.3125,576.21213 C290.3125,576.76413 289.8365,577.00013 289.25,577.00013 L288.1875,577.00013 C287.601,577.00013 287.125,576.76413 287.125,576.21213 L287.125,568.14913 C287.125,568.01613 287.181312,567.88913 287.280125,567.79513 L292.738188,562.65913 C293.153625,562.26813 293.826188,562.26813 294.240563,562.65913 L299.719875,567.81513 C299.818688,567.90913 299.875,568.03613 299.875,568.16813 L299.875,576.21213 Z M302,567.62513 C302,567.36013 301.888438,567.10713 301.690812,566.91913 L294.998125,560.58913 C294.169375,559.80613 292.823188,559.80313 291.99125,560.58313 L285.312375,566.84813 C285.112625,567.03613 285,567.29013 285,567.55613 L285,577.21213 C285,578.31713 285.950938,579.00013 287.125,579.00013 L290.3125,579.00013 C291.486562,579.00013 292.4375,578.31713 292.4375,577.21213 L292.4375,576.21213 C292.4375,575.66013 292.9135,575.21213 293.5,575.21213 C294.0865,575.21213 294.5625,575.66013 294.5625,576.21213 L294.5625,577.21213 C294.5625,578.31713 295.513438,579.00013 296.6875,579.00013 L299.875,579.00013 C301.049062,579.00013 302,578.31713 302,577.21213 L302,567.62513 Z"
                                                  id="home-[#1393]"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </div>

                </div>
            </a>

            <button class="logout-Btn share-button ai-icon-button" id="ai-button">
                <div class="ai-icon-container">
                    <img src="{% static 'main/img/ai-icon.png' %}" alt="AI">
                </div>

            </button>

            <div class="theme-block">
                <label
                        for="themeToggle"
                        class="themeToggle st-sunMoonThemeToggleBtn "
                        type="checkbox"
                >
                    <input type="checkbox" id="themeToggle" class="themeToggleInput"/>
                    <svg
                            width="18"
                            height="18"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            stroke="none"
                    >
                        <mask id="moon-mask">
                            <rect x="0" y="0" width="20" height="20" fill="white"></rect>
                            <circle cx="11" cy="3" r="8" fill="black"></circle>
                        </mask>
                        <circle
                                class="sunMoon"
                                cx="10"
                                cy="10"
                                r="8"
                                mask="url(#moon-mask)"
                        ></circle>
                        <g>
                            <circle class="sunRay sunRay1" cx="18" cy="10" r="1.5"></circle>
                            <circle class="sunRay sunRay2" cx="14" cy="16.928" r="1.5"></circle>
                            <circle class="sunRay sunRay3" cx="6" cy="16.928" r="1.5"></circle>
                            <circle class="sunRay sunRay4" cx="2" cy="10" r="1.5"></circle>
                            <circle class="sunRay sunRay5" cx="6" cy="3.1718" r="1.5"></circle>
                            <circle class="sunRay sunRay6" cx="14" cy="3.1718" r="1.5"></circle>
                        </g>
                    </svg>
                </label>
            </div>

            <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button class="logout-Btn logout-hover" type="submit">

                    <div class="sign">
                        <svg viewBox="0 0 512 512">
                            <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
                        </svg>
                    </div>

                    <div class="text">Logout</div>
                </button>

            </form>

        </div>

        <div id="error-ai-list" class="error-ai-list">

        </div>

        <div class="table-container">
            <div class="table-notes">
                <p><b>Note:</b> Avoid closing or reloading the page to prevent losing your additional
                    notes.</p>
                <p>If the AI does not respond on the first attempt, try clicking again as it may take multiple attempts
                    to work.</p>
            </div>
            <div class="planning-table main-table">
                <table border="0" id="planning-table">
                    <thead>
                    <tr>
                        {% for block_info in blocks %}
                            <th contenteditable="true">{{ block_info.block.name }}</th>
                        {% endfor %}
                        {% for i in 20|range_list %}
                            <th contenteditable="true"></th>
                        {% endfor %}
                    </tr>
                    <tr>
                        {% for block_info in blocks %}
                            <th contenteditable="true">{{ block_info.block.balance }} {{ block_info.block.currency }}</th>
                        {% endfor %}
                        {% for i in 20|range_list %}
                            <th contenteditable="true"></th>
                        {% endfor %}
                    </tr>

                    </thead>
                    <tbody>
                    {% for i in max_transactions|range_list %}
                        <tr>
                            {% for block_info in blocks %}
                                <td contenteditable="true">
                                    {% if block_info.transactions|length > forloop.parentloop.counter0 %}
                                        {% with transaction=block_info.transactions|index:forloop.parentloop.counter0 %}
                                            <div class="transaction-text-td">
                                                Transaction:
                                            </div>
                                            <div class="description-text-td">
                                                <span style="font-weight: 500;{% if transaction.amount >= 0 %}color: green;{% else %}color: red; {% endif %}">
                                                    {{ transaction.amount }} {{ block_info.block.currency }}
                                                </span><br>
                                                {{ transaction.description }}
                                            </div>
                                            <div class="transaction-date-td">
                                                {{ transaction.date }}
                                            </div>
                                        {% endwith %}
                                    {% else %}

                                    {% endif %}
                                </td>
                            {% endfor %}
                            {% for i in 20|range_list %}
                                <td contenteditable="true">

                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="table-container" id="ai-table">
            <h3>AI's response</h3>
            <p>AI can make mistakes</p>
            <div class="planning-table">


                <table id="table-ai">
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>


    </div>

{% endblock %}

{% block scripts %}
    <script type="module" src="{% static 'main/js/planning_page.js' %}"></script>
{% endblock %}