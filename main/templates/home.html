{% extends 'layout.html' %}
{% load static %}

{% block title %}Home{% endblock %}


{% block content %}

    {% if request.user.is_authenticated %}
        <div id="notification" class="notification"></div>

        <div class="home-block">
            <h2>You signed in as
                <u>{{ request.user.username }}</u>
                {% if request.user.username == 'alise' %}
                    <span style="color: purple;">
                        <3
                    </span>
                {% endif %}
            </h2>
            <div class="nav-buttons">

                <button class="logout-Btn share-button" id="share-button">

                    <div class="sign share-btn">
                        <svg viewBox="-0.5 0 25 25" fill="none"
                             xmlns="http://www.w3.org/2000/svg">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M13.47 4.13998C12.74 4.35998 12.28 5.96 12.09 7.91C6.77997 7.91 2 13.4802 2 20.0802C4.19 14.0802 8.99995 12.45 12.14 12.45C12.34 14.21 12.79 15.6202 13.47 15.8202C15.57 16.4302 22 12.4401 22 9.98006C22 7.52006 15.57 3.52998 13.47 4.13998Z"
                                      fill="#000000"/>
                            </g>
                        </svg>

                    </div>

                    <div class="text">Share</div>
                </button>


                <form method="get" class="sort-dropdown">
                    <button type="button" class="sort-button">
                        <div class="sign">

                            <svg viewBox="0 0 512 512">
                                <path d="M304 416v-352h48v352h56l-80 96-80-96h56zM208 96v352h-48v-352h-56l80-96 80 96h-56z"
                                      fill="#FFFFFF"/>
                            </svg>
                        </div>
                    </button>
                    <div class="dropdown-menu">
                        <button type="submit" name="sort" value="name" class="sort-option" title="Name">
                            <span>Aa</span>
                        </button>
                        <button type="submit" name="sort" value="increase" class="sort-option" title="Ascending">
                            <span>&#x2191;</span>
                        </button>
                        <button type="submit" name="sort" value="decrease" class="sort-option" title="Descending">
                            <span>&#x2193;</span>
                        </button>
                        <button type="submit" name="sort" value="created_at_new" class="sort-option" title="Newest">
                            <span>New</span>
                        </button>
                        <button type="submit" name="sort" value="created_at_old" class="sort-option" title="Oldest">
                            <span>Old</span>

                        </button>
                    </div>
                </form>


                <div class="add-block" id="add-block-id"></div>

                <div class="theme-block">
                    <label
                            for="themeToggle"
                            class="themeToggle st-sunMoonThemeToggleBtn "
                            type="checkbox"
                    >
                        <input type="checkbox" id="themeToggle" class="themeToggleInput"/>
                        <svg
                                width="18"
                                height="18"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                stroke="none"
                        >
                            <mask id="moon-mask">
                                <rect x="0" y="0" width="20" height="20" fill="white"></rect>
                                <circle cx="11" cy="3" r="8" fill="black"></circle>
                            </mask>
                            <circle
                                    class="sunMoon"
                                    cx="10"
                                    cy="10"
                                    r="8"
                                    mask="url(#moon-mask)"
                            ></circle>
                            <g>
                                <circle class="sunRay sunRay1" cx="18" cy="10" r="1.5"></circle>
                                <circle class="sunRay sunRay2" cx="14" cy="16.928" r="1.5"></circle>
                                <circle class="sunRay sunRay3" cx="6" cy="16.928" r="1.5"></circle>
                                <circle class="sunRay sunRay4" cx="2" cy="10" r="1.5"></circle>
                                <circle class="sunRay sunRay5" cx="6" cy="3.1718" r="1.5"></circle>
                                <circle class="sunRay sunRay6" cx="14" cy="3.1718" r="1.5"></circle>
                            </g>
                        </svg>
                    </label>
                </div>

                <form action="{% url 'logout' %}" method="post">
                    {% csrf_token %}
                    <button class="logout-Btn logout-hover" type="submit">

                        <div class="sign">
                            <svg viewBox="0 0 512 512">
                                <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
                            </svg>
                        </div>

                        <div class="text">Logout</div>
                    </button>

                </form>

            </div>

            <div class="main-block">
                {% for block in blocks %}
                    <div class="money-block" data-block-id="{{ block.id }}">
                        <span class="graph-button" data-block-id="{{ block.id }}">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M4 16h4v4H4v-4zm6-6h4v10h-4V10zm6-9h4v19h-4V1z"/>
                            </svg>
                        </span>

                        <span class="delete-money-block" id="delete-block-{{ block.id }}">&times;</span>
                        <b><p class="block-name">{{ block.name }}</p></b>
                        <hr size="4" class="line"/>
                        <p class="balance {% if block.balance < 0 %}negative-balance{% else %}positive-balance{% endif %}"
                           data-block-id="{{ block.id }}">{{ block.balance }} <b
                                style="color: var(--color-dark); font-weight: 600 !important;">{{ block.currency }}</b>
                        </p>

                        <button class="action-button top-up-button top-up">
                            <p>Top Up</p>
                        </button>
                        <button class="action-button more-button story-button ">
                            <p>More</p>
                        </button>

                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="popup-container">
            <div class="popup-content">
                <span class="close" id="add-close">&times;</span>
                <h3 class="add-label" style="display: flex; justify-content: center;">Add expenses</h3>
                <form method="post" action="{% url 'home' %}">
                    {% csrf_token %}

                    <div class="add-expenses-container">
                        <div class="add-expenses">
                            {{ form.name }}
                        </div>
                        <hr size="5" class="line_add_block"/>

                        <div class="add-expenses add-expenses-balance">
                            {{ form.balance }}
                            {{ form.currency }}
                        </div>
                    </div>
                    <div style="justify-content: center; align-items: center; text-align: center;">
                        <input class="submit_add_button" type="submit" value="Submit">
                    </div>

                </form>

            </div>
        </div>

        <div class="popup-container-transactions">
            <div class="popup-content-transactions">
                <span class="close-transactions" id="add-close1">&times;</span>
                <h3 class="add-label" style="display: flex; justify-content: center;">Transactions</h3>
                <div class="add-transaction-block">
                    <div class="transaction-button-block">
                        <button id="add-transaction-btn" class="add-transaction-btn">Add Transaction</button>
                    </div>
                    <div class="add-transaction" id="transaction-form-container">
                        <form id="transaction-form" method="post">

                            {% csrf_token %}
                            <div class="transaction-form-row">
                                <div class="transaction-form-description">
                                    {{ formTransaction.description }}
                                </div>
                                <div class="transaction-form-right">
                                    <div class="transaction-form-amount">
                                        {{ formTransaction.amount }}
                                    </div>
                                    <div class="transaction-form-submit">
                                        <button type="submit" class="submit_add_tran_button"
                                                aria-label="Add">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="40"
                                                 height="40" viewBox="0 0 48 48">
                                                <linearGradient id="IMoH7gpu5un5Dx2vID39Ra_pIPl8tqh3igN_gr1" x1="9.858"
                                                                x2="38.142" y1="9.858" y2="38.142"
                                                                gradientUnits="userSpaceOnUse">
                                                    <stop offset="0" stop-color="#9dffce"></stop>
                                                    <stop offset="1" stop-color="#50d18d"></stop>
                                                </linearGradient>
                                                <path fill="url(#IMoH7gpu5un5Dx2vID39Ra_pIPl8tqh3igN_gr1)"
                                                      d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                                                <linearGradient id="IMoH7gpu5un5Dx2vID39Rb_pIPl8tqh3igN_gr2" x1="13"
                                                                x2="36" y1="24.793" y2="24.793"
                                                                gradientUnits="userSpaceOnUse">
                                                    <stop offset=".824" stop-color="#135d36"></stop>
                                                    <stop offset=".931" stop-color="#125933"></stop>
                                                    <stop offset="1" stop-color="#11522f"></stop>
                                                </linearGradient>
                                                <path fill="url(#IMoH7gpu5un5Dx2vID39Rb_pIPl8tqh3igN_gr2)"
                                                      d="M21.293,32.707l-8-8c-0.391-0.391-0.391-1.024,0-1.414l1.414-1.414	c0.391-0.391,1.024-0.391,1.414,0L22,27.758l10.879-10.879c0.391-0.391,1.024-0.391,1.414,0l1.414,1.414	c0.391,0.391,0.391,1.024,0,1.414l-13,13C22.317,33.098,21.683,33.098,21.293,32.707z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {{ formTransaction.money_block }}

                            <input type="hidden" id="money_block_id" name="money_block" value="{{ money_block_id }}">

                        </form>
                    </div>
                </div>
                <div class="transaction-list-style">
                    <ul class="transactions-list" id="transactions-list">
                    </ul>
                </div>
            </div>
        </div>

        <div class="popup-container-top-up">
            <div class="popup-content-top-up">
                <span class="close-top-up" id="add-close2">&times;</span>
                <h3 class="add-label" style="display: flex; justify-content: center;">Top Up Balance</h3>
                <div class="add-top-up" id="top-up-form-container">
                    <form id="top-up-form" method="post" action="{% url 'top_up_balance' %}">
                        {% csrf_token %}
                        <div class="top-up-amount">
                            {{ top_up_form.amount }}
                        </div>

                        <input type="hidden" name="money_block" id="money_block_id_topup" value="">
                        <div class="top-up-submit">
                            <button class="submit_add_button" type="submit">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div class="share-popup-container" id="share-popup">
            <div class="share-popup-content" id="share-popup-content">
                <span class="close-share" id="close-share-popup">&times;</span>
                <p style="margin-bottom: 10px;">Share this link:</p>
                <div class="link-share" id="copy-share-link">
                        <input type="text" id="share-link" readonly>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M20.9983 10C20.9862 7.82497 20.8897 6.64706 20.1213 5.87868C19.2426 5 17.8284 5 15 5H12C9.17157 5 7.75736 5 6.87868 5.87868C6 6.75736 6 8.17157 6 11V16C6 18.8284 6 20.2426 6.87868 21.1213C7.75736 22 9.17157 22 12 22H15C17.8284 22 19.2426 22 20.1213 21.1213C21 20.2426 21 18.8284 21 16V15"
                                      stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                                <path d="M3 10V16C3 17.6569 4.34315 19 6 19M18 5C18 3.34315 16.6569 2 15 2H11C7.22876 2 5.34315 2 4.17157 3.17157C3.51839 3.82475 3.22937 4.69989 3.10149 6"
                                      stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                            </g>
                        </svg>
                </div>
            </div>
        </div>

        <div class="popup-container-graphs">
            <div class="popup-content-graphs">
                <span class="close-graphs" id="close-graphs">&times;</span>
                <h3 class="graphs-label" style="display: flex; justify-content: center;">
                    <span class="graphs-toggle">
                        <span class="graphs-toggle-option active" data-graph-type="expenses">Expense</span> /
                        <span class="graphs-toggle-option" data-graph-type="topups">Topup</span> Graphs
                    </span>
                </h3>
                <p id="daily-chart-label"
                   style="justify-content: center; align-items: center; text-align: center; padding-bottom: 10px; padding-top: 10px; font-weight: bold;">
                    Daily</p>
                <canvas id="daily-chart" width="400" height="200"></canvas>
                <p id="monthly-chart-label"
                   style="justify-content: center; align-items: center; text-align: center; padding-bottom: 10px; padding-top: 10px; font-weight: bold;">
                    Monthly</p>
                <canvas id="monthly-chart" width="400" height="200"></canvas>
            </div>
        </div>



    {% else %}
        <div class="check">
            <a href="{% url 'login' %}">
                <h1>Login</h1>
            </a>
        </div>

        <div class="check">
            <a href="{% url 'signup' %}">
                <h1>Sign Up</h1>
            </a>
        </div>
    {% endif %}



{% endblock %}

{% block scripts %}
    <script>
        const blockTransactions = {{ block_transactions|safe }};
        const username = '{{ request.user.username }}';
        const uniqueLink = '{{ unique_link }}';
    </script>

    <script type="module" src="{% static 'main/js/main_page.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'main/js/theme.js' %}"></script>
    <script src="{% static 'main/js/currency.js' %}"></script>


    <script type="module">
        import {showNotification} from "{% static 'main/js/modules/notifications.js' %}";

        document.addEventListener("DOMContentLoaded", function () {
            {% for message in messages %}
                {% if message.tags == 'error' %}
                    showNotification("{{ message }}", {isError: true});
                {% else %}
                    showNotification("{{ message }}", {isError: false});
                {% endif %}
            {% endfor %}
        });
    </script>

{% endblock %}